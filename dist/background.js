class c{constructor(){this.setupEventListeners()}setupEventListeners(){chrome.runtime.onInstalled.addListener(e=>{e.reason==="install"?this.handleFirstInstall():e.reason==="update"&&this.handleUpdate()}),chrome.runtime.onMessage.addListener((e,t,r)=>(this.handleMessage(e,t,r),!0)),chrome.action.onClicked.addListener(e=>{this.handleActionClick(e)})}async handleFirstInstall(){console.log("Extensão instalada pela primeira vez"),chrome.tabs.create({url:chrome.runtime.getURL("options.html")})}async handleUpdate(){console.log("Extensão atualizada");try{(await chrome.storage.sync.get("userSettings")).userSettings&&console.log("Configurações existentes encontradas")}catch(e){console.error("Erro ao verificar configurações:",e)}}async handleMessage(e,t,r){try{switch(e.type){case"GET_ACTIVE_TAB":const a=await chrome.tabs.query({active:!0,currentWindow:!0});r({tab:a[0]});break;case"EXECUTE_ON_TAB":await this.executeOnTab(e.tabId,e.action),r({success:!0});break;case"CHECK_PERMISSIONS":const o=await this.checkPermissions(e.permissions);r({hasPermissions:o});break;default:r({error:"Tipo de mensagem não reconhecido"})}}catch(a){console.error("Erro ao processar mensagem:",a),r({error:a.message})}}async handleActionClick(e){try{const r=(await chrome.storage.sync.get("userSettings")).userSettings;r!=null&&r.isConfigured||chrome.tabs.create({url:chrome.runtime.getURL("options.html")})}catch(t){console.error("Erro ao verificar configurações:",t)}}async executeOnTab(e,t){try{await chrome.tabs.sendMessage(e,{type:"EXECUTE_STEP",step:t})}catch(r){throw console.error("Erro ao executar ação na aba:",r),r}}async checkPermissions(e){try{return await chrome.permissions.contains({permissions:e})}catch(t){return console.error("Erro ao verificar permissões:",t),!1}}async cleanupOldData(){try{const e=await chrome.storage.local.get(),r=Date.now()-7*24*60*60*1e3,a=[];Object.entries(e).forEach(([o,s])=>{typeof s=="object"&&s.timestamp&&s.timestamp<r&&a.push(o)}),a.length>0&&(await chrome.storage.local.remove(a),console.log(`Limpeza concluída: ${a.length} itens removidos`))}catch(e){console.error("Erro na limpeza de dados:",e)}}}new c;chrome.alarms.create("cleanup",{periodInMinutes:24*60});chrome.alarms.onAlarm.addListener(n=>{n.name==="cleanup"&&new c().cleanupOldData()});
